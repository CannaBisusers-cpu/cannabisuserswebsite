<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>cannabisusers â€¢ Twitch</title>

  <!-- Twitch Embed Script -->
  <script src="https://embed.twitch.tv/embed/v1.js"></script>

  <style>
    :root {
      --twitch: #9146ff;
      --bg1: #0e0e10;
      --bg2: #1a1a1f;
      --card: #141418;
      --text: #ffffff;
      --muted: #b3b3b3;
      --accent: #7cffcb;
    }

    * { box-sizing: border-box; }

    body {
      margin: 0;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      color: var(--text);
      background: radial-gradient(1200px 600px at 10% -10%, #2b145a33, transparent 60%),
                  radial-gradient(800px 400px at 90% 10%, #1a5a3a33, transparent 60%),
                  linear-gradient(135deg, var(--bg1), var(--bg2));
      overflow-x: hidden;
    }

    /* Subtle animated smoke / vibe */
    .smoke {
      position: fixed;
      inset: -20% -20% -20% -20%;
      background: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="600" height="600"><filter id="n"><feTurbulence type="fractalNoise" baseFrequency="0.8" numOctaves="4"/></filter><rect width="100%" height="100%" filter="url(%23n)" opacity="0.03"/></svg>');
      animation: drift 60s linear infinite;
      pointer-events: none;
    }
    @keyframes drift { from { transform: translateX(0); } to { transform: translateX(-20%); } }

    header {
      position: sticky; top: 0; z-index: 5;
      backdrop-filter: blur(10px);
      background: linear-gradient(180deg, #0e0e10cc, #0e0e10aa);
      border-bottom: 1px solid #ffffff12;
    }

    .nav {
      max-width: 1200px; margin: 0 auto; padding: 14px 20px;
      display: flex; align-items: center; justify-content: space-between; gap: 12px;
    }

    .brand { font-weight: 900; letter-spacing: .5px; }
    .pill { padding: 8px 14px; border-radius: 999px; background: var(--twitch); color: #fff; text-decoration: none; font-weight: 700; }

    .container { max-width: 1200px; margin: 0 auto; padding: 28px 20px 80px; }

    .hero {
      display: grid; grid-template-columns: 1.2fr .8fr; gap: 24px; align-items: center;
    }
    @media (max-width: 900px) { .hero { grid-template-columns: 1fr; } }

    .card {
      background: linear-gradient(180deg, #ffffff08, #ffffff03);
      border: 1px solid #ffffff12;
      border-radius: 20px;
      padding: 18px;
      box-shadow: 0 10px 40px #00000066;
    }

    h1 { font-size: clamp(2rem, 4vw, 3rem); margin: 0 0 6px; }
    h2 { margin: 0 0 10px; }
    p { color: var(--muted); }

    .embed { width: 100%; height: 480px; border-radius: 16px; overflow: hidden; }

    .grid {
      display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 18px;
    }

    iframe { width: 100%; height: 200px; border: 0; border-radius: 14px; }

    .cta { display: flex; gap: 12px; flex-wrap: wrap; }
    .btn { padding: 12px 18px; border-radius: 12px; text-decoration: none; font-weight: 800; }
    .btn.primary { background: var(--twitch); color: #fff; }
    .btn.ghost { background: #ffffff10; color: #fff; border: 1px solid #ffffff1a; }

    footer { text-align: center; color: #777; padding: 30px 20px; border-top: 1px solid #ffffff12; }
  </style>
</head>
<body>
  <div class="smoke"></div>

  <header>
    <div class="nav">
      <div class="brand">ðŸ¦š cannabisusers</div>
      <a class="pill" href="https://www.twitch.tv/cannabisusers" target="_blank">Follow on Twitch</a>
    </div>
  </header>

  <main class="container">
    <!-- HERO / LIVE -->
    <section class="hero">
      <div class="card">
        <h1>Live on Twitch</h1>
        <p>Chill vibes, clips, VODs â€” all in one place.</p>
        <div id="twitch-embed" class="embed"></div>
      </div>
      <div class="card">
        <h2>About</h2>
        <p>Solo raids, laidâ€‘back streams, and good energy. Catch highlights and full VODs below.</p>
        <div class="cta">
          <a class="btn primary" href="https://www.twitch.tv/cannabisusers" target="_blank">Watch Live</a>
          <a class="btn ghost" href="#vods">VODs</a>
          <a class="btn ghost" href="#clips">Clips</a>
        </div>
      </div>
    </section>

    <!-- VODS (AUTO) -->
    <section id="vods" style="margin-top:40px" class="card">
      <h2>ðŸ“º Latest VODs (Auto)</h2>
      <p>Powered by Twitch API. Shows newest uploads automatically.</p>
      <div id="vodGrid" class="grid"></div>
    </section>

    <!-- CLIPS (AUTO) -->
    <section id="clips" style="margin-top:40px" class="card">
      <h2>ðŸŽ¬ Top Clips (Auto)</h2>
      <p>Recent popular clips pulled automatically.</p>
      <div id="clipGrid" class="grid"></div>
    </section>
  </main>

  <footer>Â© 2025 cannabisusers</footer>

  <script>
    // Twitch Live Embed (client-side embed still safe)
    new Twitch.Embed("twitch-embed", {
      width: "100%",
      height: 480,
      channel: "cannabisusers",
      parent: ["cannabisusers.netlify.app", "localhost"]
    });

    // ===== AUTO VODS & CLIPS (via serverless proxy) =====
    // The serverless function proxies Twitch API calls using server-side env vars.
    // It is accessible at /.netlify/functions/twitch

    async function proxy(params) {
      const qs = new URLSearchParams(params).toString();
      const r = await fetch(`/.netlify/functions/twitch?${qs}`);
      if (!r.ok) throw new Error(`Proxy error: ${r.status}`);
      return r.json();
    }

    async function getUserId() {
      const j = await proxy({ type: 'user', login: 'cannabisusers' });
      return j.data?.[0]?.id;
    }

    async function loadVods(userId) {
      const j = await proxy({ type: 'videos', user_id: userId });
      const grid = document.getElementById('vodGrid');
      grid.innerHTML = '';
      j.data.forEach(v => {
        const iframe = document.createElement('iframe');
        iframe.src = `https://player.twitch.tv/?video=${v.id}&parent=cannabisusers.netlify.app&parent=localhost`;
        iframe.allowFullscreen = true;
        grid.appendChild(iframe);
      });
    }

    async function loadClips(userId) {
      const j = await proxy({ type: 'clips', broadcaster_id: userId });
      const grid = document.getElementById('clipGrid');
      grid.innerHTML = '';
      j.data.forEach(c => {
        const iframe = document.createElement('iframe');
        iframe.src = `https://clips.twitch.tv/embed?clip=${c.id}&parent=cannabisusers.netlify.app&parent=localhost`;
        iframe.allowFullscreen = true;
        grid.appendChild(iframe);
      });
    }

    (async () => {
      try {
        const id = await getUserId();
        if (id) {
          await loadVods(id);
          await loadClips(id);
        } else {
          console.warn('Could not resolve user id from proxy');
        }
      } catch (e) {
        console.warn('Twitch proxy not available yet.', e);
      }
    })();
  </script>
</body>
</html>
